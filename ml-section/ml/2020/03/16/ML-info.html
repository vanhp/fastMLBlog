<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Multi-label Classification | Supra_PolyglotCoder</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Multi-label Classification" />
<meta name="author" content="Vanh Phomsavanh" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Info about ML-deep learning" />
<meta property="og:description" content="Info about ML-deep learning" />
<link rel="canonical" href="https://www.vanhp.com/ml-section/ml/2020/03/16/ML-info.html" />
<meta property="og:url" content="https://www.vanhp.com/ml-section/ml/2020/03/16/ML-info.html" />
<meta property="og:site_name" content="Supra_PolyglotCoder" />
<meta property="og:image" content="https://www.vanhp.com/ML-section/assets/images/ai-pic2.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-16T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Vanh Phomsavanh"},"description":"Info about ML-deep learning","dateModified":"2020-03-16T00:00:00-05:00","datePublished":"2020-03-16T00:00:00-05:00","headline":"Multi-label Classification","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.vanhp.com/ml-section/ml/2020/03/16/ML-info.html"},"image":"https://www.vanhp.com/ML-section/assets/images/ai-pic2.jpg","url":"https://www.vanhp.com/ml-section/ml/2020/03/16/ML-info.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://www.vanhp.com/feed.xml" title="Supra_PolyglotCoder" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Multi-label Classification | Supra_PolyglotCoder</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Multi-label Classification" />
<meta name="author" content="Vanh Phomsavanh" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Info about ML-deep learning" />
<meta property="og:description" content="Info about ML-deep learning" />
<link rel="canonical" href="https://www.vanhp.com/ml-section/ml/2020/03/16/ML-info.html" />
<meta property="og:url" content="https://www.vanhp.com/ml-section/ml/2020/03/16/ML-info.html" />
<meta property="og:site_name" content="Supra_PolyglotCoder" />
<meta property="og:image" content="https://www.vanhp.com/ML-section/assets/images/ai-pic2.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-16T00:00:00-05:00" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Vanh Phomsavanh"},"description":"Info about ML-deep learning","dateModified":"2020-03-16T00:00:00-05:00","datePublished":"2020-03-16T00:00:00-05:00","headline":"Multi-label Classification","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.vanhp.com/ml-section/ml/2020/03/16/ML-info.html"},"image":"https://www.vanhp.com/ML-section/assets/images/ai-pic2.jpg","url":"https://www.vanhp.com/ml-section/ml/2020/03/16/ML-info.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://www.vanhp.com/feed.xml" title="Supra_PolyglotCoder" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><!--
      edit by vanh original code header.html
    <a class="site-title" rel="author" href="/">Supra_PolyglotCoder</a>
    replace with custom code below
    -->
    <a class="site-title" rel="author" href="/"><img src="/images/gradlogo1.jpg" alt="Supra_PolyglotCoder"></img></a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/Resource-section/">Resources</a><a class="page-link" href="/ML-section/">ML</a><a class="page-link" href="/Coding-section/">Programming</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <!-- add feature image on top of post --><img src="/ML-section/assets/images/ai-pic2.jpg" alt="" class="featured-image-post" /><h1 class="post-title p-name" itemprop="name headline">Multi-label Classification</h1><p class="page-description">Info about ML-deep learning</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-03-16T00:00:00-05:00" itemprop="datePublished">
        Mar 16, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#ML-section">ML-section</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#ML">ML</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <!-- ![](/ML-section/assets/images/ai-pic2.jpg) -->

<hr />

<p>Refers to the problem of identifying the categories of objects in images that may not contain exactly one type of object or more or no object present. This simple solution is not at all widely understood or appreciated!</p>

<h2 id="pandas-and-dataframes">Pandas and DataFrames</h2>

<p>Pandas a Python library for database, it’s fast and flexible library but has non-intuitive interface. It’s used to stored manage analize structure data type. It’s also useful in ML to handle tabular and timeseries data type.</p>

<p>Dataframe is the main class that represent data in table of row and columns. It can import data from CSV file, from directories, and many others sources. And Jupyter is happily work with it.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import Pandas as pd
df = pd.read_csv(path/'train.csv')
df.head()
tmp_df = pd.DataFrame({'a':[1,2], 'b':[3,4]})
</code></pre></div></div>

<h3 id="datablock">DataBlock</h3>
<p>A fastai versatile,flexible object that manage data.
it has facility to handle Datasets,dataframe. 
It smart enough to understand data set that is working with. It’s also auto split data into train 80% validate 20%</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># empty datablock
dblock = DataBlock()
dsets = dblock.datasets(df)
len(dsets.train),len(dsets.valid)
x,y = dsets.train[0]
#take lambda/ or function as argument to retrieve filename and label
dblock2 = DataBlock(get_x = lambda r: r['fname'], get_y = lambda r: r['labels'])
dsets2 = dblock.datasets(df)
dsets2.train[0]
# take default name
dblock = DataBlock(blocks=(ImageBlock, MultiCategoryBlock),
                   get_x = get_x, get_y = get_y)
dsets = dblock.datasets(df)
dsets.train[0]
</code></pre></div></div>

<h3 id="binary-cross-entropy-loss">Binary cross entropy Loss</h3>
<p>One of the problem with multiple label is finding appropiate loss function that can handle the possibility of multi-label and no label may present in data. The regular cross entropy loss is only able to deal with single label. Finding loss function that suitable for case where there more than one label or no label present is needed.</p>

<h3 id="learner-object">Learner object</h3>

<p>The Learner object inherit from nn.Module comprise with:</p>
<ol>
  <li>The model</li>
  <li>DataLoaders object</li>
  <li>Optimizer</li>
  <li>Loss function</li>
</ol>

<p>It can receive x as a mini-batch and return activation value</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>learn = cnn_learner(dls, resnet18)
activ = learn.model(x)
activ.shape

def binary_cross_entropy(inputs, targets):
    inputs = inputs.sigmoid()
    return -torch.where(targets==1, inputs, 1-inputs).log().mean()
# using PyTorch version
# by default fastai will use this version
loss_func = nn.BCEWithLogitsLoss()
loss = loss_func(activs, y)
loss
</code></pre></div></div>

<p>due to one-hot-encoded dependent variable because there may be more than object the cross_entropy is not appropriate
In the case where more than one object is possible, or no object present may want the sum to be &lt; 1
this excluse softmax and nll_loss</p>

<p>softmax: limitation:</p>
<ul>
  <li>all value must sum to 1</li>
  <li>the largest value get exagerate
nll_loss limitation:</li>
  <li>it return only one value correspond to the single label
we need to return more than 1 label</li>
</ul>

<h4 id="comparable-pytorch-versions-that-work-with-one-hot-encoding">Comparable PyTorch versions that work with one-hot encoding:</h4>
<ul>
  <li>F.binary_cross_entropy (no sigmoid)</li>
  <li>nn.BCELoss  (nosigmoid)</li>
  <li>F.binary_cross_entropy_with_logits</li>
  <li>nn.BCEWithLogitsLoss
Single label version:
F.nll_loss
nn.NLLLoss (no softmax)
F.cross_entropy
nn.CrossEntropyLoss</li>
</ul>

<h3 id="measurement-metric">Measurement metric</h3>
<p>Since there maybe more than one or object present need a new metric for accuracy</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># value &gt; thresh is consider 1, else consider 0, default threshold = 0.5
def accuracy_multi(inp, targ, thresh=0.5, sigmoid=True):
    "Compute accuracy when `inp` and `targ` are the same size."
    if sigmoid: inp = inp.sigmoid()
    return ((inp&gt;thresh)==targ.bool()).float().mean()

# train the model
learn = cnn_learner(dls, resnet50, metrics=partial(accuracy_multi, thresh=0.2))
learn.fine_tune(3, base_lr=3e-3, freeze_epochs=4)

</code></pre></div></div>
<p>High threshold select the high confident of model
Low threshold select low confident of model</p>

<p>find the best threshold by trying a few levels and seeing what works best</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># this apply sigmoid by default
preds,targs = learn.get_preds()
# no sigmoid
accuracy_multi(preds, targs, thresh=0.9, sigmoid=False)
# plot it
xs = torch.linspace(0.05,0.95,29)
accs = [accuracy_multi(preds, targs, thresh=i, sigmoid=False) for i in xs]
plt.plot(xs,accs)
</code></pre></div></div>

<p><em>Note</em></p>
<ul>
  <li>zip(b[0],b[1]) has short cut of zip(*b)</li>
  <li>python can’t save (serialization lambda) lambda use function instead</li>
  <li>it’s OK to use validation set to pick threshold it should not overfit</li>
</ul>

<h3 id="jagons">Jagons</h3>
<ul>
  <li>x: is independent variable</li>
  <li>y: is dependent variable</li>
  <li>Dataset: A collection that can be index into it and returns a tuple of your independent and dependent variable for a single item</li>
  <li>DataLoader: An iterator that provides a stream of mini-batches, where each mini-batch is a tuple of a batch of independent variables and a batch of dependent variables</li>
  <li>one-hot-encoder: a vector that has all 0 but one 1 to represent the interested item to pick-out from other item</li>
</ul>

<p>Fastai library</p>
<ul>
  <li>Datasets: An object that contains a training Dataset and a validation Dataset part of fastai library</li>
  <li>DataLoaders: An object that contains a training DataLoader and a validation DataLoader part of fastai library</li>
</ul>

<hr />
<p><em>——————————————————————————————————</em></p>

   
  </div><a class="u-url" href="/ml-section/ml/2020/03/16/ML-info.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Supra_PolyglotCoder</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Vanh Phomsavanh</li><li><a class="u-email" href="mailto:vanhphom@gmail.com">vanhphom@gmail.com</a></li>
            <li>&copy; VSP LLC 2020 </li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://www.twitter.com/SupraCoder"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">SupraCoder</span></a></li><li><a href="https://github.com/vanhp"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">vanhp</span></a></li><li><a href="https://www.facebook.com/vanh+phom"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#facebook"></use></svg> <span class="username">vanh phom</span></a></li><li><a href="https://www.linkedin.com/in/vanh-phomsavanh-1bba668"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#linkedin"></use></svg> <span class="username">vanh-phomsavanh-1bba668</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>A blog about my journey into Machine Learning and coding experience in general</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
